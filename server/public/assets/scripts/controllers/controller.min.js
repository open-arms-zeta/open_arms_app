/*! open_arms_app 2015-12-17 */
myApp.controller("AddClientController",["$scope","DataService","$http","$filter",function(a,b,c,d){console.log("Add client Controller Online"),a.myFiles=[],a.dataService=b,a.categories=void 0,a.newClient={},void 0==a.categories?a.dataService.retrieveCategories().then(function(){a.categories=a.dataService.getCategories(),console.log(a.categories)}):a.categories=a.dataService.getCategories(),a.associateCategoryID=function(){console.log(a.categories)},a.submit=function(){a.addClientForm.$valid&&(console.log(a.newClient),a.newClient.password=a.newClient.phone.toString(),c.post("/register",a.newClient).then(function(a){console.log(a.data)}),a.clearInput())},a.clearInput=function(){a.newClient={},a.addClientForm.$setUntouched()},a.handler=function(a,b){var c=new FileReader;c.onload=function(a){var b=c.result,d=Papa.parse(b,{header:!0});console.log("1st",d)},c.readAsText(b[0]),Papa.parse(b[0],{complete:function(a){console.log("these results",a)}})},console.log(a.categories)}]),myApp.directive("fileChange",["$parse",function(a){return{require:"ngModel",restrict:"A",link:function(b,c,d,e){var f=a(d.fileChange),g=function(a){b.$apply(function(){f(b,{$event:a,files:a.target.files})})};c[0].addEventListener("change",g,!1)}}}]),myApp.controller("AdminWelcomeController",["$scope","DataService","$http","$filter",function(a,b,c,d){console.log("AdminWelcome Controller Online"),a.dataService=b,a.activeWeek=void 0,a.selectedStartDate=void 0,a.selectedEndDate=void 0,a.selectedMealCount=void 0,a.clientOrders=void 0,a.initSelectedWeek=function(){a.selectedStartDate=a.activeWeek;var b=new Date(a.selectedStartDate);a.selectedEndDate=b.setDate(b.getDate()+6)},a.moveSelectedWeek=function(b){var c=new Date(a.selectedStartDate);a.selectedStartDate=c.setDate(c.getDate()+b);var d=new Date(a.selectedEndDate);a.selectedEndDate=d.setDate(d.getDate()+b)},a.previousWeek=function(){a.moveSelectedWeek(-7),a.getMealCount(),a.getClientOrders()},a.nextWeek=function(){a.moveSelectedWeek(7),a.getMealCount(),a.getClientOrders()},a.getMealCount=function(){var b=new Date(a.selectedStartDate),d=new Date(a.selectedEndDate);c.get("/mealcount",{params:{startDate:b,endDate:d}}).then(function(b){a.selectedMealCount=b.data})},a.getClientOrders=function(){var b=new Date(a.selectedStartDate),c=new Date(a.selectedEndDate);a.dataService.retrieveClientOrders(b,c).then(function(){a.clientOrders=a.dataService.getClientOrders()})},a.printMealCount=function(){console.log(a.selectedMealCount);for(var b=0;b<a.selectedMealCount.length;b++)a.selectedMealCount[b].start_date=d("date")(a.selectedMealCount[b].start_date,"fullDate"),a.selectedMealCount[b].end_date=d("date")(a.selectedMealCount[b].end_date,"fullDate");return a.selectedMealCount},a.printClientOrders=function(){console.log(a.clientOrders);for(var b=0;b<a.selectedMealCount.length;b++)a.clientOrders[b].start_date=d("date")(a.clientOrders[b].start_date,"fullDate"),a.clientOrders[b].end_date=d("date")(a.clientOrders[b].end_date,"fullDate");return a.clientOrders},void 0==a.activeWeek?(a.dataService.calculateActiveWeek(),a.activeWeek=a.dataService.getActiveWeek()):a.activeWeek=a.dataService.getActiveWeek(),a.initSelectedWeek(),a.getMealCount()}]),myApp.controller("CalculateMealsController",["$scope","DataService","$http",function(a,b,c){console.log("calculate meals Controller Online"),a.dataService=b,a.clientOrders=a.dataService.getClientOrders(),a.activeWeek=void 0,a.menu=void 0,a.categories=a.dataService.getCategories(),a.displayResults=!1,a.meal={},a.mealCount=[],a.getOrderWeek=function(){var b=new Date(a.activeWeek);a.selectedStartDate=new Date(b.setDate(a.activeWeek.getDate()-7));var c=new Date(a.activeWeek);a.selectedEndDate=c.setDate(a.activeWeek.getDate()-1)},a.calculateMeals=function(){for(var b=0;b<a.menu.length;b++){console.log(a.menu[b]);var c=_.where(a.categories,{category_name:a.menu[b].category_name})[0];a.menu[b].count=c.formCount||0;var d=_.where(a.clientOrders,{entree:a.menu[b].entree});if(d.length>0){var e=_.pluck(d,"count").reduce(function(a,b){return a+b});console.log(e),a.menu[b].count+=e}}console.log(a.menu),a.displayResults=!0,a.postMealCount()},void 0==a.categories?a.dataService.retrieveCategories().then(function(){a.categories=a.dataService.getCategories()}):a.categories=a.dataService.getCategories(),void 0==a.activeWeek?(a.dataService.calculateActiveWeek(),a.activeWeek=a.dataService.getActiveWeek(),a.getOrderWeek()):(a.activeWeek=a.dataService.getActiveWeek(),a.getOrderWeek()),void 0==a.menu?a.dataService.retrieveMenuByWeek(a.selectedStartDate,a.selectedEndDate).then(function(){a.menu=a.dataService.getMenu()}):a.menu=a.dataService.getMenu(),void 0==a.clientOrders?a.dataService.retrieveClientOrders(a.selectedStartDate,a.selectedEndDate).then(function(){a.clientOrders=a.dataService.getClientOrders()}):a.clientOrders=a.dataService.getClientOrders(),a.postMealCount=function(){for(var b=0;b<a.menu.length;b++)console.log(a.menu[b]),c.post("/mealcount",a.menu[b]).then(function(a){console.log(a)})}}]),myApp.controller("ClientWelcomeController",["$scope","DataService","$http",function(a,b,c){console.log("Client Welcome Controller Online"),a.dataService=b,a.user=void 0,a.activeWeek=void 0,a.menu=void 0,a.categories=void 0,a.mealsChosen=!1,a.customized=!1,void 0==a.user?a.dataService.retrieveUser().then(function(){a.user=a.dataService.getUser()}):a.user=a.dataService.getUser(),void 0==a.activeWeek?(a.dataService.calculateActiveWeek(),a.activeWeek=a.dataService.getActiveWeek()):a.activeWeek=a.dataService.getActiveWeek(),void 0==a.categories?a.dataService.retrieveCategories().then(function(){a.categories=a.dataService.getCategories()}):a.categories=a.dataService.getCategories(),void 0==a.menu?a.dataService.retrieveMenuByWeek("2015-12-05","2015-12-05").then(function(){a.menu=a.dataService.getMenu(),console.log(a.menu)}):a.menu=a.dataService.getMenu(),a.customize=function(){a.customized=!0},a.completeOrder=function(){a.mealsChosen=!0}}]),myApp.controller("CreateMealController",["$scope","$http","DataService",function(a,b,c){console.log("create meal Controller Online"),a.meal={categories:[],allergens:[],status:!0},a.mealCategories=function(){b({method:"GET",url:"/getcategories"}).then(function(b){console.log("categories",b.data),a.categories=b.data})},a.mealCategories(),a.mealAllergens=function(){b({method:"GET",url:"/getallergens"}).then(function(b){console.log("allergy",b.data),a.allergens=b.data})},a.mealAllergens(),a.submit=function(b){console.log("submitr",b),console.log("here is the meal",a.meal),console.log(a.meal)},a.clearInput=function(){a.meal={},a.createMeal.$setUntouched()},a.findAllergen=function(b){var c=_.pluck(a.meal.allergens,"allergen_name");return _.contains(c,b)},a.associate=function(b,c){var d=_.findLastIndex(a.meal.allergens,{allergen_name:b});a.meal.allergens[d].specific=c}}]),myApp.controller("CreateMenuController",["$scope","$http","DataService",function(a,b,c){console.log("create menu Controller Online"),a.dataService=c,a.allMeals=[],a.mealByCategory={},a.allergens=[],a.selectedMealArray=[],a.menu={},a.menuId,a.menuPreBuild={},a.hideDropDown=!1,void 0==a.categories?a.dataService.retrieveCategories().then(function(){a.categories=a.dataService.getCategories(),a.getMeals()}):(a.categories=a.dataService.getCategories(),a.getMeals()),a.getMeals=function(){b.get("/createmenu/meals").then(function(b){a.allMeals=b.data;for(var c=0;c<a.categories.length;c++){a.categories[c].mealInfo=[];for(var d=0;d<a.allMeals.length;d++)a.categories[c].category_name==a.allMeals[d].category_name&&a.categories[c].mealInfo.push(a.allMeals[d])}for(var c=0;c<a.categories.length;c++)a.menuPreBuild[a.categories[c].category_name]=[]})},a.saveMeals=function(b,c,d){a.menuPreBuild[c][d]=b},a.createMenu=function(c){a.selectedMealArray=_.flatten(_.values(a.menuPreBuild)),b.post("/createmenu/newMenu",c).then(function(){a.getMenuId(c)})},a.getMenuId=function(c){b.get("/createmenu/getMenuId",{params:{startDate:c.startDate}}).then(function(b){a.menuId=b.data[0].menu_id,a.postToMealMenu()})},a.postToMealMenu=function(c){b.post("/createmenu/saveToMealMenu",{menuId:a.menuId,mealsArray:a.selectedMealArray}).then(function(){console.log("menu saved"),a.hideDropDown=!0})}}]),myApp.controller("SearchClientController",["$scope","DataService","$http",function(a,b,c){console.log("search client Controller Online"),a.clientData=void 0,a.search="",a.retrieveAll=function(){c.get("/searchclients/all").then(function(b){console.log(b.data),a.clientData=b.data})},a.getSearchResults=function(){0==a.search.length?a.retrieveAll():(console.log(a.search),c.get("/searchclients",{params:{name:a.search}}).then(function(b){console.log(b.data),a.clientData=b.data}),a.search="")},a.gridOptions={data:"clientData",enableSorting:!0,columnDefs:[{field:"first_name",displayName:"First Name",enableCellEdit:!1},{field:"last_name",displayName:"Last Name",enableCellEdit:!1},{field:"email",displayName:"Email Address",enableCellEdit:!1},{field:"phone",displayName:"Phone Number",enableCellEdit:!1},{field:"default_meal",displayName:"Default Pack",enableCellEdit:!1},{field:"status",displayName:"Active Status",type:"boolean",cellTemplate:'<div ng-show="row.entity.status"><input type="checkbox" ng-model="row.entity.status" ng-click="grid.appScope.updateRow(row)"> Active</div><div ng-hide="row.entity.status"><input type="checkbox" ng-model="row.entity.status" ng-click="grid.appScope.updateRow(row)"> Inactive</div>',editableCellTemplate:'<div ng-show="row.entity.status"><input type="checkbox" ng-model="row.entity.status" ng-click="grid.appScope.updateRow(row)"> Active</div><div ng-hide="row.entity.status"><input type="checkbox" ng-model="row.entity.status" ng-click="grid.appScope.updateRow(row)"> Inactive</div>'}]},a.updateClients=function(){console.log(a.clientData)},a.updateRow=function(a){var b=a.entity;c.put("/searchclients/update",b).then(function(a){console.log(a.data)})},a.retrieveAll()}]),myApp.controller("ViewMealController",["$scope","$http","$uibModal",function(a,b,c){console.log("view meal Controller Online"),a.allMeals=[],a.showAll=function(){b.get("/getmeals/showAll").then(function(b){console.log("showall Response: ",b.data),a.allMeals=b.data})},a.searchMeals=function(){console.log(a.meal.searchTerm),b.get("/getmeals/searchMeal",{params:{searchTerm:a.meal.searchTerm}}).then(function(b){console.log("search Meals Response:",b.data),a.allMeals=b.data})},a.gridOptions={data:"allMeals",enableSorting:!0,enableRowSelection:!0,columnDefs:[{field:"entree",displayName:"Entree",enableCellEdit:!1},{field:"side_1",displayName:"Side 1",enableCellEdit:!1},{field:"side_2",displayName:"Side 2",enableCellEdit:!1},{field:"view",name:"view",displayName:"View",cellTemplate:'<div class="ui-grid-cell-contents"><button ng-click="grid.appScope.viewMeal(row)">View</button></div>'},{field:"delete",name:"delete",displayName:"Delete",cellTemplate:'<div class="ui-grid-cell-contents"><button ng-click="grid.appScope.deleteMeal(row)">Delete</button></div>'}]},a.deleteMeal=function(c){console.log("delete Meal!"),console.log(c),a.mealID=c.entity.meal_id,c.entity.status=!1,b.put("/getmeals/changeStatus",{meal_id:a.mealID}).then(function(b){console.log(b),a.allMeals=b.data}),console.log(c.entity)},a.viewMeal=function(b){console.log("view meal!"),console.log(b),a.open("lg",b)},a.animationsEnabled=!0,a.open=function(b,d){c.open({animation:a.animationsEnabled,templateUrl:"./templates/viewmealmodal.html",controller:"ModalInstanceCtrl",size:b,resolve:{row:function(){return d}}})},a.toggleAnimation=function(){a.animationsEnabled=!a.animationsEnabled}}]),myApp.controller("ModalInstanceCtrl",["$scope","$http","$uibModalInstance","row",function(a,b,c,d){a.row=d,a.mealid=d.entity.meal_id,console.log(a.mealid),b.get("/getmeals/mealExtras",{params:{meal_id:a.mealid}}).then(function(b){console.log("mealExtras Response: ",b.data),a.displayData=b.data}),a.ok=function(){c.close("close")}}]),myApp.controller("ViewMenuController",["$scope","$http","DataService",function(a,b,c){console.log("view menu Controller Online"),a.dataService=c,a.showCategoryHeadings=!1,a.menu={},a.allMeals=[],a.mealsInMenuArray=[],a.defaultMeal=[],a.menuPreBuild={},a.selectedMealArray=[],a.menuId,a.hideDropDown=!0,a.weekNumber,void 0==a.categories?a.dataService.retrieveCategories().then(function(){a.categories=a.dataService.getCategories(),a.getMeals()}):(a.categories=a.dataService.getCategories(),a.getMeals()),a.getMeals=function(){b.get("/createmenu/meals").then(function(b){a.allMeals=b.data;for(var c=0;c<a.categories.length;c++){a.categories[c].mealInfo=[];for(var d=0;d<a.allMeals.length;d++)a.categories[c].category_name==a.allMeals[d].category_name&&a.categories[c].mealInfo.push(a.allMeals[d])}for(var c=0;c<a.categories.length;c++)a.menuPreBuild[a.categories[c].category_name]=[]})},a.getMenu=function(b){a.hideDropDown=!0,a.categories=a.dataService.getCategories(),a.dataService.retrieveMenuByWeek(b.startDate,b.endDate).then(function(){a.menuByWeek=a.dataService.getMenu(),a.menuId=a.menuByWeek[0].menu_id,a.weekNumber=a.menuByWeek[0].week_number,console.log(a.menuByWeek,a.menuId,a.weekNumber),a.setDefault()}),a.showCategoryHeadings=!0},a.setDefault=function(){for(var b=0;b<a.categories.length;b++){a.categories[b].defaultMeal=[];for(var c=0;c<a.categories[b].mealInfo.length;c++)for(var d=0;d<a.menuByWeek.length;d++)a.menuByWeek[d].meal_id==a.categories[b].mealInfo[c].meal_id&&a.menuByWeek[d].category_id==a.categories[b].mealInfo[c].category_id&&(a.categories[b].defaultMeal.push(a.categories[b].mealInfo[c]),a.menuPreBuild[a.categories[b].category_name]=a.categories[b].defaultMeal)}},a.saveMeals=function(b,c,d){a.menuPreBuild[c][d]=b},a.createMenu=function(c){a.selectedMealArray=_.flatten(_.values(a.menuPreBuild)),b["delete"]("/getmenu/removeMealsFromMenu",{params:{menuId:a.menuId}}).then(function(){a.postToMealMenu()})},a.postToMealMenu=function(){b.post("/createmenu/saveToMealMenu",{menuId:a.menuId,mealsArray:a.selectedMealArray}).then(function(){console.log("HI"),a.hideDropDown=!1,a.showCategoryHeadings=!1})}}]);