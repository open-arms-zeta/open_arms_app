/*! open_arms_app 2016-01-08 */
myApp.controller("AddClientController",["$scope","DataService","$http","$uibModal",function(a,b,c,d){console.log("Add client Controller Online"),a.dataService=b,a.categories=void 0,a.clients=void 0,a.newClient={},void 0==a.clients&&c.get("/register/all").then(function(b){a.clients=b.data,console.log("clients in db",a.clients)}),void 0==a.categories?a.dataService.retrieveCategories().then(function(){a.categories=a.dataService.getCategories(),console.log(a.categories)}):a.categories=a.dataService.getCategories(),a.associateCategoryID=function(){console.log(a.categories)},a.submit=function(){a.addClientForm.$valid&&(console.log(a.newClient),a.newClient.password=a.newClient.phone.toString(),c.post("/register",a.newClient).then(function(a){console.log(a.data)}),a.clearInput())},a.clearInput=function(){a.newClient={},a.addClientForm.$setUntouched()},a.openCSVModal=function(){var a="lg",b=d.open({animation:!0,templateUrl:"/assets/views/templates/importclients.html",controller:"ImportClientController",size:a});b.result.then(function(){console.log("modal closed")})},a.clientExists=function(b){return console.log(_.findWhere(a.clients,{email:b})),a.$apply(function(){return _.findWhere(a.clients,{email:b})?(a.addClientForm.inputEmail.$setValidity("unique",!1),!0):(a.addClientForm.inputEmail.$setValidity("unique",!0),!1)})}}]),myApp.directive("isUnique",["$http","DataService",function(a,b){return{restrict:"A",require:"ngModel",link:function(b,c,d,e){c.on("keyup",function(){var b=c[0].value;return a.get("/register/all").then(function(a){var c=a.data;_.findWhere(c,{email:b})&&b.length>0?(console.log("true!"),e.$setValidity("isunique",!1)):(console.log("false!"),e.$setValidity("isunique",!0))})})}}}]),myApp.controller("AdminWelcomeController",["$scope","DataService","$http","$filter",function(a,b,c,d){console.log("AdminWelcome Controller Online"),a.dataService=b,a.activeWeek=void 0,a.orderDate=void 0,a.selectedStartDate=void 0,a.selectedMealCount=void 0,a.clientOrders=void 0,a.initSelectedWeek=function(){var b=new Date(a.activeWeek);console.log(b),a.selectedStartDate=a.orderDate=new Date(b.setDate(a.activeWeek.getDate()-7)),console.log(a.selectedStartDate)},a.moveSelectedWeek=function(b){var c=new Date(a.selectedStartDate);a.selectedStartDate=c.setDate(c.getDate()+b),a.getMealCount(),a.getClientOrders()},a.previousWeek=function(){a.moveSelectedWeek(-7)},a.nextWeek=function(){a.moveSelectedWeek(7)},a.getMealCount=function(){var b=new Date(a.selectedStartDate);console.log("start date",b),c.get("/mealcount",{params:{startDate:b}}).then(function(b){a.selectedMealCount=a.formatForDisplay(b.data)})},a.getClientOrders=function(){var b=new Date(a.selectedStartDate);a.dataService.retrieveClientOrders(b).then(function(){a.clientOrders=a.dataService.getClientOrders()})},a.printMealCount=function(){console.log(a.selectedMealCount);for(var b=0;b<a.selectedMealCount.length;b++)a.selectedMealCount[b].start_date=d("date")(a.selectedMealCount[b].start_date,"fullDate");return a.selectedMealCount},a.printClientOrders=function(){console.log(a.clientOrders);for(var b=0;b<a.clientOrders.length;b++)a.clientOrders[b].start_date=d("date")(a.clientOrders[b].start_date,"fullDate");return a.clientOrders},a.formatForDisplay=function(a){console.log(a);var b=_.groupBy(a,"entree");console.log(b,"goaspfasdf");var c=[];for(var d in b){console.log("key",d),c.push(b[d][0]);for(var e=1;e<b[d].length;e++)c[c.length-1].count+=b[d][e].count}return c},a.disableNext=function(){return"object"==typeof a.selectedEndDate?a.orderDate<=a.selectedStartDate.getTime():(console.log(typeof a.orderDate),console.log(typeof a.selectedStartDate),a.orderDate<=a.selectedStartDate)},void 0==a.activeWeek?(a.dataService.calculateActiveWeek(),a.activeWeek=a.dataService.getActiveWeek()):a.activeWeek=a.dataService.getActiveWeek(),a.initSelectedWeek(),a.getMealCount(),a.getClientOrders()}]),myApp.controller("CalculateMealsController",["$scope","DataService","$http",function(a,b,c){console.log("calculate meals Controller Online"),a.dataService=b,a.clientOrders=a.dataService.getClientOrders(),a.activeWeek=void 0,a.menu=void 0,a.categories=a.dataService.getCategories(),a.displayResults=!1,a.whenSubmit=!1,a.meal={},a.mealCount=[],a.getOrderWeek=function(){var b=new Date(a.activeWeek);a.selectedStartDate=new Date(b.setDate(a.activeWeek.getDate()-7));var c=new Date(a.activeWeek);a.selectedEndDate=c.setDate(a.activeWeek.getDate()-1)},a.calculateMeals=function(){for(var b=0;b<a.menu.length;b++){console.log("meal number",b,a.menu[b]);var c=_.where(a.categories,{category_name:a.menu[b].category_name})[0];a.menu[b].count=c.formCount||0;var d=_.where(a.clientOrders,{entree:a.menu[b].entree});if(d.length>0){var e=_.pluck(d,"count").reduce(function(a,b){return a+b});console.log(e),a.menu[b].count+=e}}console.log("final menu",a.menu),a.whenSubmit=!0,a.displayResults=!0,a.postMealCount()},void 0==a.categories?a.dataService.retrieveCategories().then(function(){a.categories=a.dataService.getCategories()}):a.categories=a.dataService.getCategories(),void 0==a.activeWeek?(a.dataService.calculateActiveWeek(),a.activeWeek=a.dataService.getActiveWeek(),a.getOrderWeek()):(a.activeWeek=a.dataService.getActiveWeek(),a.getOrderWeek()),void 0==a.menu?a.dataService.retrieveMenuByWeek(a.selectedStartDate).then(function(){a.menu=a.dataService.getMenu()}):a.menu=a.dataService.getMenu(),void 0==a.clientOrders?a.dataService.retrieveClientOrders(a.selectedStartDate).then(function(){a.clientOrders=a.dataService.getClientOrders()}):a.clientOrders=a.dataService.getClientOrders(),a.postMealCount=function(){console.log("post",a.menu),c.post("/mealcount",a.menu).then(function(b){console.log(b),a.menu=a.formatForDisplay(a.menu)})},a.formatForDisplay=function(a){console.log(a);var b=_.groupBy(a,"entree");console.log(b,"goaspfasdf");var c=[];for(var d in b){console.log("key",d),c.push(b[d][0]);for(var e=1;e<b[d].length;e++)c[c.length-1].count+=b[d][e].count}return c}}]),myApp.controller("ClientWelcomeController",["$scope","DataService","$http",function(a,b,c){console.log("Client Welcome Controller Online"),a.dataService=b,a.user=void 0,a.activeWeek=void 0,a.menu=void 0,a.categories=void 0,a.modalShown=!1,a.modalShown2=!1,a.modalShown3=!1,a.showBasket=!1,a.showMobileConfirmation=!1,a.mealsChosen=!1,a.customized=!1,a.notActive=!1,a.mealsWithAllergens=[],a.accordion={current:null},a.addedMealArray=[],a.uniqueMealArray=[],a.orderToPost=[],a.orderedMealsArray=[],a.badgeNumber=0,a.instructionNumber=0,a.loadedImage=void 0,a.instructionImages={confirmation:"http://res.cloudinary.com/dhro0fkhc/image/upload/v1452127817/screen_confirm_ybfmmf.png",welcome:"http://res.cloudinary.com/dhro0fkhc/image/upload/v1452127818/screen_welcome_highlight_nbd9sp.png",inactive:"http://res.cloudinary.com/dhro0fkhc/image/upload/v1452127817/screen_inactive_oqfgvc.png",selection1:"http://res.cloudinary.com/dhro0fkhc/image/upload/v1452127813/screen_chose_meals_1_highlight_ziqrxl.png",selection2:"http://res.cloudinary.com/dhro0fkhc/image/upload/v1452127813/screen_choose_meals_2_highlight_fhh4a4.png"},a.nextInstruction=function(){4==a.instructionNumber?a.instructionNumber=0:a.instructionNumber++,a.setImage()},a.prevInstruction=function(){0==a.instructionNumber?a.instructionNumber=4:a.instructionNumber--,a.setImage()},a.setImage=function(){switch(a.instructionNumber){case 0:a.loadedImage=a.instructionImages.welcome;break;case 1:a.loadedImage=a.instructionImages.selection1;break;case 2:a.loadedImage=a.instructionImages.selection2;break;case 3:a.loadedImage=a.instructionImages.confirmation;break;case 4:a.loadedImage=a.instructionImages.inactive}},a.setImage(),void 0==a.user?a.dataService.retrieveUser().then(function(){a.user=a.dataService.getUser(),a.checkClientStatus(a.user),a.checkNewUser(a.user)}):(a.user=a.dataService.getUser(),a.checkClientStatus(a.user),a.checkNewUser(a.user)),void 0==a.activeWeek?(a.dataService.calculateActiveWeek(),a.activeWeek=a.dataService.getActiveWeek(),a.activeWeek=new Date(a.activeWeek.setHours(0,0,0,0))):(a.activeWeek=a.dataService.getActiveWeek(),a.activeWeek=new Date(a.activeWeek.setHours(0,0,0,0))),void 0==a.categories?a.dataService.retrieveCategories().then(function(){a.categories=a.dataService.getCategories()}):a.categories=a.dataService.getCategories(),void 0==a.menu?a.dataService.retrieveMenuByWeek(a.activeWeek).then(function(){a.menu=a.dataService.getMenu(),console.log("This is menu",a.menu),console.log("This is active week",a.activeWeek),a.matchAllergens(),a.pushMenu(),a.checkHasOrdered()}):(a.menu=a.dataService.getMenu(),a.matchAllergens(),a.pushMenu(),a.checkHasOrdered()),a.pushMenu=function(){for(var b=0;b<a.categories.length;b++){a.categories[b].mealInfo=[];for(var c=0;c<a.menu.length;c++)a.categories[b].category_name==a.menu[c].category_name&&a.categories[b].mealInfo.push(a.menu[c])}},a.matchAllergens=function(){for(var b=0;b<a.menu.length;b++)a.getAllergen(b);console.log(a.menu)},a.getAllergen=function(b){a.menu[b].allergen=[],c.get("/getmeals/allergenExtras",{params:{meal_id:a.menu[b].meal_id}}).then(function(c){for(var d=0;d<c.data.length;d++)c.data[d].allergen_specific?a.menu[b].allergen.push(c.data[d].allergen_name+" - "+c.data[d].allergen_specific):a.menu[b].allergen.push(c.data[d].allergen_name)})},a.checkClientStatus=function(b){0==b.status&&(a.notActive=!0)},a.checkNewUser=function(b){b.new_user&&(a.toggleModal3(),c.put("/getclients/updateNewUser",{id:b.id}).then(function(){console.log("Change new_user to false")}))},a.checkHasOrdered=function(){return c.get("/getclients/checkOrdered",{params:{clientId:a.user.id,menuId:a.menu[0].menu_id}}).then(function(b){b.data[0]&&(console.log("This person ordered...",b.data),a.orderedMealsArray=b.data,console.log("This is orderedMealsArray",a.orderedMealsArray),a.mealsChosen=!0,a.customized=!1)})},a.customize=function(){a.customized=!0},a.postDefaultMeal=function(){a.modalShown=!a.modalShown;for(var b=0;b<a.menu.length;b++)a.user.category_id==a.menu[b].category_id&&a.orderToPost.push({clientId:a.user.id,menuId:a.menu[0].menu_id,mealId:a.menu[b].meal_id,categoryId:a.menu[b].category_id,count:1});return c.post("/postclientorders/saveClientOrders",a.orderToPost).then(function(){a.checkHasOrdered()})},a.toggleModal=function(){a.modalShown=!a.modalShown},a.toggleModal2=function(){a.modalShown2=!a.modalShown2},a.toggleModal3=function(){a.modalShown3=!a.modalShown3},a.toggleBasket=function(){a.showBasket=!a.showBasket},a.toggleBasketSubmission=function(){a.showMobileConfirmation=!a.showMobileConfirmation,a.showBasket=!a.showBasket},a.addMeal=function(b){a.addedMealArray.push(b),a.badgeNumber=a.addedMealArray.length},a.removeMeal=function(b){a.addedMealArray.splice(b,1),a.badgeNumber=a.addedMealArray.length},a.postCustomMeal=function(){a.uniqueMealArray=_.uniq(a.addedMealArray);for(var b=0;b<a.uniqueMealArray.length;b++)a.orderToPost.push({clientId:a.user.id,menuId:a.menu[0].menu_id,mealId:a.uniqueMealArray[b].meal_id,categoryId:a.uniqueMealArray[b].category_id,count:0});for(var b=0;b<a.uniqueMealArray.length;b++)for(var d=0;d<a.addedMealArray.length;d++)a.uniqueMealArray[b].meal_id==a.addedMealArray[d].meal_id&&a.uniqueMealArray[b].category_id==a.addedMealArray[d].category_id&&(a.orderToPost[b].count+=1);c.post("/postclientorders/saveClientOrders",a.orderToPost).then(function(){a.checkHasOrdered()}),a.modalShown2=!a.modalShown2},a.backToHome=function(){a.customized=!1,a.modalShown3=!1}}]),myApp.controller("CreateMealController",["$scope","$http","DataService",function(a,b,c){console.log("create meal Controller Online"),a.mealEntrySuccess=!1,a.meal={categories:[],allergens:[],status:!0},a.mealCategories=function(){b({method:"GET",url:"/getcategories"}).then(function(b){console.log("categories",b.data),a.categories=b.data})},a.mealCategories(),a.mealAllergens=function(){b({method:"GET",url:"/getallergens"}).then(function(b){console.log("allergy",b.data),a.allergens=b.data})},a.mealAllergens(),a.submit=function(){console.log("here is the meal",a.meal),b({method:"POST",url:"/postmeals/saveToMealsTable",data:a.meal}).then(function(b){a.newMealID(),a.mealEntrySuccess=!0})},a.refreshForm=function(){a.mealEntrySuccess=!1,a.meal={categories:[],allergens:[],status:!0}},a.refreshForm(),a.newMealID=function(){b({method:"GET",url:"/postmeals/getNewMealID"}).then(function(b){console.log("This is the mealID coming back",b.data[0]),a.mealId=b.data[0].meal_id,a.postToMealCategory(),a.postToAllergens(),a.clearInput()})},a.postToMealCategory=function(){b({method:"POST",url:"/postmeals/postToMealCategory",data:{mealId:a.mealId,mealObject:a.meal}}).then(function(){})},a.postToAllergens=function(){b({method:"POST",url:"/postmeals/postToAllergens",data:{mealId:a.mealId,mealObject:a.meal}}).then(function(){})},a.clearInput=function(){a.meal={},a.createMeal.$setUntouched()},a.findAllergen=function(b){var c=_.pluck(a.meal.allergens,"allergen_name");return _.contains(c,b)},a.associate=function(b,c){var d=_.findLastIndex(a.meal.allergens,{allergen_name:b});a.meal.allergens[d].specific=c},a.ifNoAllergen=function(b){return"No Allergen"!=b.allergen_name&&_.findWhere(a.meal.allergens,{allergen_name:"No Allergen"})?(a.meal.allergens=[_.findWhere(a.allergens,{allergen_name:"No Allergen"})],!1):!0}}]),myApp.controller("CreateMenuController",["$scope","$http","DataService",function(a,b,c){console.log("create menu Controller Online"),a.dataService=c,a.allMeals=[],a.mealByCategory={},a.allergens=[],a.selectedMealArray=[],a.menu={},a.menuId,a.menuPreBuild={},a.hideDropDown=!1,a.activeWeek=void 0,a.menuExist=!1,a.showSaveSuccessMessage=!1,a.categoryIndex,a.disableButton=!1,void 0==a.activeWeek?(a.dataService.calculateActiveWeek(),a.activeWeek=a.dataService.getActiveWeek()):a.activeWeek=a.dataService.getActiveWeek(),void 0==a.categories?a.dataService.retrieveCategories().then(function(){a.categories=a.dataService.getCategories(),a.getMeals()}):(a.categories=a.dataService.getCategories(),a.getMeals()),a.getMeals=function(){b.get("/createmenu/meals").then(function(b){a.allMeals=b.data;for(var c=0;c<a.categories.length;c++){a.categories[c].mealInfo=[];for(var d=0;d<a.allMeals.length;d++)a.categories[c].category_name==a.allMeals[d].category_name&&a.categories[c].mealInfo.push(a.allMeals[d])}console.log("This is categories array",a.categories);for(var c=0;c<a.categories.length;c++)a.menuPreBuild[a.categories[c].category_name]=Array.apply(null,Array(5)).map(function(){})})},a.combined=function(a){return null==a.side_2?a.entree+" with "+a.side_1:a.entree+" with "+a.side_1+" and "+a.side_2},a.checkExistingMenu=function(c){a.menuExist=!1,a.hideDropDown=!1,b.get("/createmenu/getMenuId",{params:{startDate:c}}).then(function(b){null!=b.data[0]&&(console.log("this menu already exist"),a.menuExist=!0,a.hideDropDown=!0)})},a.saveMeals=function(b,c,d,e){a.menuPreBuild[c][d]=b,a.checkMealDuplicates(c,e)},a.checkMealDuplicates=function(b,c){a.categoryIndex=_.indexOf(a.categories,c),a.categories[a.categoryIndex].mealDuplicateError=!1,_.compact(a.menuPreBuild[b]).length>_.compact(_.uniq(a.menuPreBuild[b])).length&&(a.categories[a.categoryIndex].mealDuplicateError=!0,a.disableButton=!0)},a.createMenu=function(c){a.selectedMealArray=_.compact(_.flatten(_.values(a.menuPreBuild))),console.log(a.selectedMealArray),b.post("/createmenu/newMenu",c).then(function(){a.getMenuId(c)})},a.getMenuId=function(c){b.get("/createmenu/getMenuId",{params:{startDate:c.startDate}}).then(function(b){console.log("This is menu start date",c.startDate),a.menuId=b.data[0].menu_id,a.postToMealMenu()})},a.postToMealMenu=function(c){b.post("/createmenu/saveToMealMenu",{menuId:a.menuId,mealsArray:a.selectedMealArray}).then(function(){console.log("menu saved"),a.hideDropDown=!0,a.showSaveSuccessMessage=!0})},a.disabled=function(b,c){return"day"===c&&(0===b.getDay()||b.getDay()>1||b.setHours(0,0,0,0)<=a.activeWeek.setHours(0,0,0,0))},a.toggleMin=function(){a.minDate=a.minDate?null:new Date},a.toggleMin(),a.maxDate=new Date(2020,5,22),a.open=function(b){a.status.opened=!0},a.setDate=function(b,c,d){a.menu.startDate=new Date(b,c,d)},a.dateOptions={formatYear:"yy",startingDay:0},a.formats=["dd-MMMM-yyyy","yyyy/MM/dd","MM/dd/yyyy","shortDate"],a.format=a.formats[2],a.status={opened:!1};var d=new Date;d.setDate(d.getDate()+1);var e=new Date;e.setDate(d.getDate()+2),a.events=[{date:d,status:"full"},{date:e,status:"partially"}],a.getDayClass=function(b,c){if("day"===c)for(var d=new Date(b).setHours(0,0,0,0),e=0;e<a.events.length;e++){var f=new Date(a.events[e].date).setHours(0,0,0,0);if(d===f)return a.events[e].status}return""}}]),myApp.controller("ImportClientController",["$scope","$uibModalInstance","$http","DataService",function(a,b,c,d){console.log("controller on"),a.csvClients=void 0,a.clients=void 0,a.clientsAdded=!1,a.dataService=d,a.categories=void 0,void 0==a.categories?a.dataService.retrieveCategories().then(function(){a.categories=a.dataService.getCategories()}):a.categories=a.dataService.getCategories(),void 0==a.clients&&c.get("/register/all").then(function(b){a.clients=b.data,console.log("clients in db",a.clients)}),a.remove=function(){a.csvClients=void 0},a.uploadFile=function(b){console.log("doing stuff");var c={header:!0,complete:function(b){console.log("alkjsdf"),a.csvClients=e(b.data),console.log("finished",a.csvClients),a.$apply()}};Papa.parse(b[0],c)},a.gridOptions={data:"csvClients",enableSorting:!0,columnDefs:[{field:"first_name",displayName:"First Name",enableCellEdit:!1},{field:"last_name",displayName:"Last Name",enableCellEdit:!1},{field:"email",displayName:"Email Address",enableCellEdit:!1},{field:"phone",displayName:"Phone Number",enableCellEdit:!1},{field:"default_meal",displayName:"Default Pack",enableCellEdit:!1}]};var e=function(b){b=_.uniq(b,"Email"),b=_.filter(b,function(b){return console.log("entry",b),_.findWhere(a.clients,{email:b.Email})?void console.log("duplicate email!"):b}),console.log("raw",b);var c=[];return _.each(b,function(b){var d=function(){var c=_.where(a.categories,{category_name:b["Default Pack"]});return 0==c.length?a.categories[0]:c[0]},e={email:b.Email,first_name:b["First Name"],last_name:b["Last Name"],phone:b.Phone,default_meal:d().category_name,category_id:d().category_id};c.push(e)}),c};a.post=function(){c.post("/register/groupregister",a.csvClients).then(function(b){console.log(b),a.csvClients=void 0,a.clientsAdded=!0})},a.close=function(){b.close("close")}}]),myApp.directive("customOnChange",function(){return{restrict:"A",link:function(a,b,c){var d=a.$eval(c.customOnChange);b.bind("change",function(a){var b=a.target.files;d(b)}),b.bind("click",function(){b.val("")})}}}),myApp.controller("SearchClientController",["$scope","DataService","$http",function(a,b,c){console.log("search client Controller Online"),a.clientData=void 0,a.search="",a.retrieveAll=function(){c.get("/searchclients/all").then(function(b){console.log(b.data),a.clientData=b.data})},a.getSearchResults=function(){0==a.search.length?a.retrieveAll():(console.log(a.search),c.get("/searchclients",{params:{name:a.search}}).then(function(b){console.log(b.data),a.clientData=b.data}),a.search="")},a.gridOptions={data:"clientData",enableSorting:!0,columnDefs:[{field:"first_name",displayName:"First Name",enableCellEdit:!1},{field:"last_name",displayName:"Last Name",enableCellEdit:!1},{field:"email",displayName:"Email Address",enableCellEdit:!1},{field:"phone",displayName:"Phone Number",enableCellEdit:!1},{field:"default_meal",displayName:"Default Pack",enableCellEdit:!1},{field:"status",displayName:"Active Status",type:"boolean",cellTemplate:'<div ng-show="row.entity.status"><input type="checkbox" ng-model="row.entity.status" ng-click="grid.appScope.updateRow(row)"> Active</div><div ng-hide="row.entity.status"><input type="checkbox" ng-model="row.entity.status" ng-click="grid.appScope.updateRow(row)"> Inactive</div>',editableCellTemplate:'<div ng-show="row.entity.status"><input type="checkbox" ng-model="row.entity.status" ng-click="grid.appScope.updateRow(row)"> Active</div><div ng-hide="row.entity.status"><input type="checkbox" ng-model="row.entity.status" ng-click="grid.appScope.updateRow(row)"> Inactive</div>'}]},a.updateClients=function(){console.log(a.clientData)},a.updateRow=function(a){var b=a.entity;c.put("/searchclients/update",b).then(function(a){console.log(a.data)})},a.retrieveAll()}]),myApp.controller("ViewMealController",["$scope","$http","$uibModal",function(a,b,c){console.log("view meal Controller Online"),a.search=void 0,a.allMeals=[],a.showAll=function(){b.get("/getmeals/showAll").then(function(b){console.log("showall Response: ",b.data),a.allMeals=b.data})},a.getSearchResults=function(){console.log(a.search),a.search.length>0?b.get("/getmeals/searchMeal",{params:{searchTerm:a.search}}).then(function(b){console.log("search Meals Response:",b.data),a.allMeals=b.data,a.search=""}):a.showAll()},a.gridOptions={data:"allMeals",rowHeight:40,enableSorting:!0,columnDefs:[{field:"entree",displayName:"Entree",enableCellEdit:!1},{field:"side_1",displayName:"Side 1",enableCellEdit:!1},{field:"side_2",displayName:"Side 2",enableCellEdit:!1},{field:"view",name:"view",displayName:"View",cellClass:"ui-grid-vcenter",cellTemplate:'<div class="ui-grid-cell-contents"><button ng-click="grid.appScope.viewMeal(row)" class="custom-button-ui-grid">View</button></div>'},{field:"delete",name:"delete",displayName:"Delete",cellClass:"ui-grid-vcenter",cellTemplate:'<div class="ui-grid-cell-contents"><button ng-click="grid.appScope.deleteMeal(row)" class="custom-button-ui-grid">Delete</button></div>'}]},a.deleteMeal=function(c){console.log("delete Meal!"),console.log(c),a.mealID=c.entity.meal_id,c.entity.status=!1,b.put("/getmeals/changeStatus",{meal_id:a.mealID}).then(function(b){console.log(b),a.allMeals=b.data}),console.log(c.entity)},a.viewMeal=function(b){console.log("view meal!"),console.log(b),a.open("lg",b)},a.open=function(a,b){var d=c.open({animation:!0,templateUrl:"/assets/views/templates/viewmealmodal.html",controller:"ViewMealModalController",size:a,resolve:{row:function(){return b}}});d.result.then(function(){console.log("closed")})},a.showAll()}]),myApp.controller("ViewMealModalController",["$scope","$http","$uibModalInstance","row",function(a,b,c,d){a.row=d,a.mealid=d.entity.meal_id,console.log(a.mealid),b.get("/getmeals/mealExtras",{params:{meal_id:a.mealid}}).then(function(b){console.log("mealExtras Response: ",b.data),a.displayData=b.data}),a.close=function(){c.close("close")}}]),myApp.filter("unique",function(){return function(a,b){if(b===!1)return a;if((b||angular.isUndefined(b))&&angular.isArray(a)){var c=[],d=function(a){return angular.isObject(a)&&angular.isString(b)?a[b]:a};angular.forEach(a,function(a){for(var b=!1,e=0;e<c.length;e++)if(angular.equals(d(c[e]),d(a))){b=!0;break}b||c.push(a)}),a=c}return a}}),myApp.controller("ViewMenuController",["$scope","$http","DataService",function(a,b,c){console.log("view menu Controller Online"),a.dataService=c,a.showCategoryHeadings=!1,a.menu={},a.allMeals=[],a.mealsInMenuArray=[],a.defaultMeal=[],a.menuPreBuild={},a.selectedMealArray=[],a.menuId,a.hideDropDown=!0,a.hideEditSuccessMessage=!0,a.weekNumber,a.activeWeek=void 0,a.disableDropDown=!1,a.noMenuMessage=!1,a.oldMenuMessage=!1,a.disableButton=!1,void 0==a.activeWeek?(a.dataService.calculateActiveWeek(),a.activeWeek=a.dataService.getActiveWeek(),console.log(a.activeWeek)):a.activeWeek=a.dataService.getActiveWeek(),void 0==a.categories?a.dataService.retrieveCategories().then(function(){a.categories=a.dataService.getCategories(),a.getMeals()}):(a.categories=a.dataService.getCategories(),a.getMeals()),a.getMeals=function(){b.get("/createmenu/meals").then(function(b){a.allMeals=b.data;for(var c=0;c<a.categories.length;c++){a.categories[c].mealInfo=[];for(var d=0;d<a.allMeals.length;d++)a.categories[c].category_name==a.allMeals[d].category_name&&a.categories[c].mealInfo.push(a.allMeals[d])}for(var c=0;c<a.categories.length;c++)a.menuPreBuild[a.categories[c].category_name]=[]})},a.getMenu=function(c){a.hideDropDown=!0,a.hideEditSuccessMessage=!0,a.disableDropDown=!1,a.noMenuMessage=!1,a.oldMenuMessage=!1,a.menu.startDate<=a.activeWeek&&(a.oldMenuMessage=!0),b.get("/createmenu/getMenuId",{params:{startDate:c.startDate}}).then(function(b){console.log(b.data),null==b.data[0]?(console.log("this menu does not exist"),a.noMenuMessage=!0,a.disableDropDown=!0):(a.hideDropDown=!1,a.categories=a.dataService.getCategories(),a.dataService.retrieveMenuByWeek(c.startDate).then(function(){a.menuByWeek=a.dataService.getMenu(),a.menuId=a.menuByWeek[0].menu_id,a.weekNumber=a.menuByWeek[0].week_number,console.log(a.menuByWeek,a.menuId,a.weekNumber),a.setDefault()}),a.showCategoryHeadings=!0)})},a.combined=function(a){return null==a.side_2?a.entree+" with "+a.side_1:a.entree+" with "+a.side_1+" and "+a.side_2},a.setDefault=function(){for(var b=0;b<a.categories.length;b++){a.categories[b].defaultMeal=[];for(var c=0;c<a.categories[b].mealInfo.length;c++)for(var d=0;d<a.menuByWeek.length;d++)a.menuByWeek[d].meal_id==a.categories[b].mealInfo[c].meal_id&&a.menuByWeek[d].category_id==a.categories[b].mealInfo[c].category_id&&(a.categories[b].defaultMeal.push(a.categories[b].mealInfo[c]),a.menuPreBuild[a.categories[b].category_name]=a.categories[b].defaultMeal)}},a.saveMeals=function(b,c,d,e){a.menuPreBuild[c][d]=b,a.checkMealDuplicates(c,e)},a.checkMealDuplicates=function(b,c){a.categoryIndex=_.indexOf(a.categories,c),a.categories[a.categoryIndex].mealDuplicateError=!1,_.compact(a.menuPreBuild[b]).length>_.compact(_.uniq(a.menuPreBuild[b])).length&&(a.categories[a.categoryIndex].mealDuplicateError=!0,a.disableButton=!0)},a.createMenu=function(c){a.selectedMealArray=_.flatten(_.values(a.menuPreBuild)),b["delete"]("/getmenu/removeMealsFromMenu",{params:{menuId:a.menuId}}).then(function(){a.postToMealMenu()})},a.postToMealMenu=function(){b.post("/createmenu/saveToMealMenu",{menuId:a.menuId,mealsArray:a.selectedMealArray}).then(function(){console.log("HI"),a.hideDropDown=!1,a.hideEditSuccessMessage=!1,a.showCategoryHeadings=!1})},a.disabled=function(a,b){return"day"===b&&(0===a.getDay()||a.getDay()>1)},a.toggleMin=function(){a.minDate=a.minDate?null:new Date},a.toggleMin(),a.maxDate=new Date(2020,5,22),a.open=function(b){a.status.opened=!0},a.setDate=function(b,c,d){a.menu.startDate=new Date(b,c,d)},a.dateOptions={formatYear:"yy",startingDay:0},a.formats=["dd-MMMM-yyyy","yyyy/MM/dd","MM/dd/yyyy","shortDate"],a.format=a.formats[2],a.status={opened:!1};var d=new Date;d.setDate(d.getDate()+1);var e=new Date;e.setDate(d.getDate()+2),a.events=[{date:d,status:"full"},{date:e,status:"partially"}],a.getDayClass=function(b,c){if("day"===c)for(var d=new Date(b).setHours(0,0,0,0),e=0;e<a.events.length;e++){var f=new Date(a.events[e].date).setHours(0,0,0,0);if(d===f)return a.events[e].status}return""}}]);