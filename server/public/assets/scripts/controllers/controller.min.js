/*! angular_factory_lecture 2015-12-16 */
myApp.controller("AddClientController",["$scope","DataService",function(a,b){console.log("Add client Controller Online")}]),myApp.controller("AdminWelcomeController",["$scope","DataService",function(a,b){console.log("AdminWelcome Controller Online")}]),myApp.controller("CalculateMealsController",["$scope","DataService","$http",function(a,b,c){console.log("calculate meals Controller Online"),a.dataService=b,a.clientOrders=a.dataService.getClientOrders(),a.activeWeek=void 0,a.menu=void 0,a.categories=a.dataService.getCategories(),a.displayResults=!1,a.meal={},a.mealCount=[],void 0==a.categories?a.dataService.retrieveCategories().then(function(){a.categories=a.dataService.getCategories()}):a.categories=a.dataService.getCategories(),void 0==a.activeWeek?(a.dataService.calculateActiveWeek(),a.activeWeek=a.dataService.getActiveWeek()):a.activeWeek=a.dataService.getActiveWeek(),void 0==a.menu?a.dataService.retrieveMenuByWeek("2015-12-05","2015-12-05").then(function(){a.menu=a.dataService.getMenu()}):a.menu=a.dataService.getMenu(),void 0==a.clientOrders?a.dataService.retrieveClientOrders("2015-12-05","2015-12-05").then(function(){a.clientOrders=a.dataService.getClientOrders()}):a.clientOrders=a.dataService.getClientOrders(),a.calculateMeals=function(){for(var b=0;b<a.menu.length;b++){console.log(a.menu[b]);var c=_.where(a.categories,{category_name:a.menu[b].category_name})[0];a.menu[b].count=c.formCount||0;var d=_.where(a.clientOrders,{entree:a.menu[b].entree});if(d.length>0){var e=_.pluck(d,"count").reduce(function(a,b){return a+b});console.log(e),a.menu[b].count+=e}}console.log(a.menu),a.displayResults=!0}}]),myApp.controller("CreateMealController",["$scope","DataService",function(a,b){console.log("create meal Controller Online")}]),myApp.controller("CreateMenuController",["$scope","$http","DataService",function(a,b,c){console.log("create menu Controller Online"),a.dataService=c,a.allMeals=[],a.mealByCategory={},a.allergens=[],a.selectedMealArray=[],a.menu={},a.menuId,a.menuPreBuild={},a.hideDropDown=!1,void 0==a.categories?a.dataService.retrieveCategories().then(function(){a.categories=a.dataService.getCategories(),a.getMeals()}):(a.categories=a.dataService.getCategories(),a.getMeals()),a.getMeals=function(){b.get("/createmenu/meals").then(function(b){a.allMeals=b.data;for(var c=0;c<a.categories.length;c++){a.categories[c].mealInfo=[];for(var d=0;d<a.allMeals.length;d++)a.categories[c].category_name==a.allMeals[d].category_name&&a.categories[c].mealInfo.push(a.allMeals[d])}for(var c=0;c<a.categories.length;c++)a.menuPreBuild[a.categories[c].category_name]=[]})},a.saveMeals=function(b,c,d){a.menuPreBuild[c][d]=b},a.createMenu=function(c){a.selectedMealArray=_.flatten(_.values(a.menuPreBuild)),b.post("/createmenu/newMenu",c).then(function(){a.getMenuId(c)})},a.getMenuId=function(c){b.get("/createmenu/getMenuId",{params:{startDate:c.startDate}}).then(function(b){a.menuId=b.data[0].menu_id,a.postToMealMenu()})},a.postToMealMenu=function(c){b.post("/createmenu/saveToMealMenu",{menuId:a.menuId,mealsArray:a.selectedMealArray}).then(function(){console.log("menu saved"),a.hideDropDown=!0})}}]),myApp.controller("SearchClientController",["$scope","DataService",function(a,b){console.log("search client Controller Online")}]),myApp.controller("ViewMealController",["$scope","DataService",function(a,b){console.log("view meal Controller Online")}]),myApp.controller("ViewMenuController",["$scope","$http","DataService",function(a,b,c){console.log("view menu Controller Online"),a.dataService=c,a.showCategoryHeadings=!1,a.menu={},a.allMeals=[],a.mealsInMenuArray=[],a.defaultMeal=[],a.menuPreBuild={},a.selectedMealArray=[],a.menuId,a.hideDropDown=!0,void 0==a.categories?a.dataService.retrieveCategories().then(function(){a.categories=a.dataService.getCategories(),a.getMeals()}):(a.categories=a.dataService.getCategories(),a.getMeals()),a.getMeals=function(){b.get("/createmenu/meals").then(function(b){a.allMeals=b.data;for(var c=0;c<a.categories.length;c++){a.categories[c].mealInfo=[];for(var d=0;d<a.allMeals.length;d++)a.categories[c].category_name==a.allMeals[d].category_name&&a.categories[c].mealInfo.push(a.allMeals[d])}for(var c=0;c<a.categories.length;c++)a.menuPreBuild[a.categories[c].category_name]=[]})},a.getMenu=function(b){a.hideDropDown=!0,a.categories=a.dataService.getCategories(),a.dataService.retrieveMenuByWeek(b.startDate,b.endDate).then(function(){a.menuByWeek=a.dataService.getMenu(),a.menuId=a.menuByWeek[0].menu_id,console.log(a.menuByWeek,a.menuId),a.setDefault()}),a.showCategoryHeadings=!0},a.setDefault=function(){for(var b=0;b<a.categories.length;b++){a.categories[b].defaultMeal=[];for(var c=0;c<a.categories[b].mealInfo.length;c++)for(var d=0;d<a.menuByWeek.length;d++)a.menuByWeek[d].meal_id==a.categories[b].mealInfo[c].meal_id&&a.menuByWeek[d].category_id==a.categories[b].mealInfo[c].category_id&&(a.categories[b].defaultMeal.push(a.categories[b].mealInfo[c]),a.menuPreBuild[a.categories[b].category_name]=a.categories[b].defaultMeal)}},a.saveMeals=function(b,c,d){a.menuPreBuild[c][d]=b},a.createMenu=function(c){a.selectedMealArray=_.flatten(_.values(a.menuPreBuild)),b["delete"]("/getmenu/removeMealsFromMenu",{params:{menuId:a.menuId}}).then(function(){a.postToMealMenu()})},a.postToMealMenu=function(){b.post("/createmenu/saveToMealMenu",{menuId:a.menuId,mealsArray:a.selectedMealArray}).then(function(){console.log("HI"),a.hideDropDown=!1,a.showCategoryHeadings=!1})}}]);